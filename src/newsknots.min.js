var TimeKnots={draw:function(t,e,i){var r={width:600,height:200,radius:10,lineWidth:4,color:"#999",background:"#FFF",dateFormat:"%Y/%m/%d %H:%M:%S",showLabels:!1,labelFormat:"%Y/%m/%d %H:%M:%S",seriesColor:d3.scale.category20()};if(void 0!=i)for(var n in i)r[n]=i[n];var o=d3.select(t).append("svg").attr("width",r.width).attr("height",r.height),a=e.map(function(t){return Date.parse(t.publishedAt)}),s=d3.max(a),l=d3.min(a),u=1.5*(d3.max(e.map(function(t){return t.radius}))||r.radius)+r.lineWidth,d=(r.width-2*u)/(s-l),c=[];if(s==l&&(d=0,u=r.width/2),o.selectAll("line").data(e).enter().append("line").attr("class","timeline-line").attr("x1",function(t,i){var n=new Date(t.publishedAt).getTime(),o=Math.floor(d*(n-l)+u),a=e[i-1];return null!=a&&Math.abs(o-a.x1)<2*r.radius&&(o=a.x1),t.x1=o,o}).attr("x2",function(t,i){var n=null!=e[i-1]?e[i-1]:t,o=new Date(n.publishedAt).getTime(),a=Math.floor(d*(o-l)+u),s=e[i-2];return null!=s&&Math.abs(a-s.x2)<2*r.radius&&(a=s.x2),n.x2=a,a}).attr("y1",function(t,i){var n=new Date(t.publishedAt).getTime(),o=Math.floor(d*(n-l)+u),a=Math.floor(r.height/4),s=e[i-1];return null!=s&&Math.abs(o-s.cx)<2*r.radius&&(a=s.cy+2*r.radius+5,o=s.cx),t.cy=a,t.cx=o,a}).attr("y2",function(t,e){return Math.floor(r.height/4)}).style("stroke",function(t){return void 0!=t.color?t.color:void 0!=t.series?(c.indexOf(t.series)<0&&c.push(t.series),r.seriesColor(c.indexOf(t.series))):r.color}).style("stroke-width",r.lineWidth),tip=d3.tip().attr("class","d3-tip").html(function(t){var e='<img src="'+t.urlToImage+'" style="float:left; margin-right:4px;" width="86px">';return e=e+"<h6>"+t.title+"<h6>",e=e+"<small>"+t.source.name+"</small>"}),tip.direction("s"),tip.offset([15,0]),o.call(tip),o.selectAll("circle").data(e).enter().append("circle").attr("class","timeline-event").attr("r",function(t){return void 0!=t.radius?t.radius:r.radius}).style("stroke",function(t){return void 0!=t.color?t.color:void 0!=t.series?(c.indexOf(t.series)<0&&c.push(t.series),console.log(t.series,c,c.indexOf(t.series)),r.seriesColor(c.indexOf(t.series))):r.color}).style("stroke-width",function(t){return void 0!=t.lineWidth?t.lineWidth:r.lineWidth}).style("fill",function(t){return void 0!=t.background?t.background:r.background}).attr("cy",function(t,i){var n=new Date(t.publishedAt).getTime(),o=Math.floor(d*(n-l)+u),a=Math.floor(r.height/4),s=e[i-1];return null!=s&&Math.abs(o-s.cx)<2*r.radius&&(a=s.cy+2*r.radius+5,o=s.cx),t.cy=a,t.cx=o,a}).attr("cx",function(t,i){var n=new Date(t.publishedAt).getTime(),o=Math.floor(d*(n-l)+u),a=e[i-1];return null!=a&&Math.abs(o-a.cx)<2*r.radius&&(o=a.cx),t.cx=o,o}).on("mouseover",function(t){d3.select(this).style("fill",function(t){return void 0!=t.color?t.color:r.color}).transition().duration(100).attr("r",function(t){return void 0!=t.radius?Math.floor(1.5*t.radius):Math.floor(1.5*r.radius)}),tip.show(t)}).on("mouseout",function(t){tip.hide(t),d3.select(this).style("fill",function(t){return void 0!=t.background?t.background:r.background}).transition().duration(100).attr("r",function(t){return void 0!=t.radius?t.radius:r.radius})}).on("click",function(t){window.open(t.url)}),0!=r.showLabels){var h=d3.time.format(r.labelFormat),f=h(new Date(l)),x=h(new Date(s));o.append("text").text(f).style("font-size","70%").attr("x",function(t){return d3.max([0,u-this.getBBox().width/2])}).attr("y",function(t){return Math.floor(r.height/4-(u+this.getBBox().height))}),o.append("text").text(x).style("font-size","70%").attr("x",function(t){return r.width-d3.max([this.getBBox().width,u+this.getBBox().width/2])}).attr("y",function(t){return Math.floor(r.height/4-(u+this.getBBox().height))})}}};
